<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AI Image Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:900px;margin:28px auto;padding:16px}
    h1{margin:0 0 10px}
    textarea{width:100%;min-height:120px;padding:10px;font-size:14px;border:1px solid #ddd;border-radius:6px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
    input[type=number]{width:100px;padding:8px;border-radius:6px;border:1px solid #ddd}
    button{padding:10px 14px;border:none;background:#0b6cff;color:#fff;border-radius:8px;cursor:pointer}
    button[disabled]{opacity:.6;cursor:default}
    .status{margin-top:12px;font-weight:600}
    .result{margin-top:12px}
    img{max-width:100%;border:1px solid #eee;border-radius:8px}
    pre{background:#f7f7f7;padding:10px;border-radius:6px;overflow:auto}
    .small{font-size:13px;color:#666}
  </style>
</head>
<body>
  <h1>AI Image Generator</h1>
  <p class="small">Backend: <code id="backend"></code></p>

  <label>Prompt</label>
  <textarea id="prompt">A photo-realistic image of a peaceful South Indian (Telugu) village at sunset: mud houses, palm trees, farmers, cows, warm golden light.</textarea>

  <div class="controls">
    <label>Width <input id="width" type="number" value="512" min="64" /></label>
    <label>Height <input id="height" type="number" value="512" min="64" /></label>
    <label>Samples <input id="samples" type="number" value="1" min="1" max="4" /></label>
    <button id="gen">Generate Image</button>
  </div>

  <div id="status" class="status">Idle</div>
  <div id="result" class="result"></div>
  <div id="debug" style="margin-top:12px"></div>

  <script>
    // If you serve frontend from same origin as backend (Render backend), leave BACKEND empty.
    // If hosting frontend separately, set the full backend URL like 'https://charan4.onrender.com'
    const BACKEND = 'https://server-j-v1x1.onrender.com'; // set to backend origin if needed

    document.getElementById('backend').textContent = BACKEND || location.origin;

    const promptEl = document.getElementById('prompt');
    const widthEl = document.getElementById('width');
    const heightEl = document.getElementById('height');
    const samplesEl = document.getElementById('samples');
    const genBtn = document.getElementById('gen');
    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');
    const debugEl = document.getElementById('debug');

    function setStatus(msg) { statusEl.textContent = msg; }
    function setDebug(obj) { debugEl.innerHTML = '<pre>' + JSON.stringify(obj, null, 2) + '</pre>'; }

    async function postJson(url, body) {
      const resp = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const text = await resp.text();
      try { return { ok: resp.ok, status: resp.status, json: JSON.parse(text) }; } catch(e) { return { ok: resp.ok, status: resp.status, text }; }
    }

    genBtn.addEventListener('click', async () => {
      setStatus('Requesting image...');
      resultEl.innerHTML = '';
      debugEl.innerHTML = '';
      genBtn.disabled = true;

      const prompt = promptEl.value.trim();
      const width = parseInt(widthEl.value||'512', 10);
      const height = parseInt(heightEl.value||'512', 10);
      const samples = parseInt(samplesEl.value||'1', 10);

      if (!prompt || prompt.length < 3) {
        setStatus('Please enter a longer prompt.');
        genBtn.disabled = false;
        return;
      }

      const resp = await postJson((BACKEND || '') + '/api/generate-image', { prompt, width, height, samples });
      if (!resp.ok) {
        setStatus('Error: ' + (resp.json?.error || resp.text || resp.status));
        setDebug(resp.json || resp.text);
        genBtn.disabled = false;
        return;
      }

      const data = resp.json;
      if (data.imageUrl) {
        // imageUrl may be a relative path like /out/xxx.png
        const src = (BACKEND ? BACKEND : location.origin) + data.imageUrl;
        const img = document.createElement('img');
        img.src = src;
        img.alt = 'Generated image';
        resultEl.innerHTML = '';
        resultEl.appendChild(img);
        setStatus('Image ready');
        setDebug(data.providerResponse);
      } else {
        setStatus('No image returned');
        setDebug(data);
      }
      genBtn.disabled = false;
    });

    // optional health-check
    (async function health() {
      try {
        const h = await fetch((BACKEND || '') + '/health');
        if (h.ok) setStatus('Backend online');
      } catch (e) {
        setStatus('Backend offline or not reachable');
      }
    })();
  </script>
</body>
</html>
